server {
  listen 3000;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # Tipos MIME essenciais para os bundles gerados pelo Vite
  types {
    text/html html htm;
    text/css css;
    application/javascript js mjs;
    application/json json;
    application/manifest+json webmanifest;
    image/png png;
    image/jpeg jpg jpeg;
    image/svg+xml svg svgz;
    image/webp webp;
    font/woff2 woff2;
    font/woff woff;
  }
  default_type application/octet-stream;

  # Servir diretório de assets gerado pelo Vite
  location /assets/ {
    alias /usr/share/nginx/html/assets/;
    try_files $uri =404;
    add_header Cache-Control "public, max-age=31536000, immutable";
  }

  # Assets estáticos adicionais podem ser cacheados agressivamente
  location ~* \.(?:js|mjs|css|png|jpe?g|svg|webp|ico|woff2?|ttf)$ {
    try_files $uri =404;
    add_header Cache-Control "public, max-age=31536000, immutable";
  }

  # Manifestos, service workers e HTML principal não devem ser cacheados
  location ~* \.(?:html|json|webmanifest|txt|xml|sw.js)$ {
    try_files $uri =404;
    add_header Cache-Control "no-store";
  }

  # Health check simples para o compose
  location = /health {
    access_log off;
    add_header Content-Type text/plain;
    return 200 "healthy\n";
  }

  # SPA fallback: qualquer rota que não seja arquivo real rende index.html
  location / {
    try_files $uri $uri/ /index.html;
    add_header Cache-Control "no-store";
  }
}
